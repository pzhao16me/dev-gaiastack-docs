# 3. 操作指引
普通用户首次登录GaiaStack平台之后将在简单的操作指引之后默认进入demo项目，用户如需创建或加入新的项目则需要向系统管理员申请新建或加入其他项目，用户可线下联系系统管理员获得支持。

GaiaStack 地址为：gaiastack.oa.com

首次进入管理台，可看到以下指引界面，您可以通过切换阅读简单了解目前平台为您提供的服务：
![](/assets/1.png)



接下来我们将详细介绍GaiaStack为您提供的从代码构建到应用部署的全流程的云实例服务。
***
##3.1 业务总览
业务总览页面是GaiaStcak的第一个页面，概要展示了用户所选项目的总资源及相关操作信息：
![](/assets/2.png)


* 业务基本信息： 应用数、实例数及状态（可点击跳转到应用列表）；

* 业务组基本信息： 管理员、成员数；

* 业务所有的集群资源及资源使用状态，点击右上角的图表“更多”可以查看详细的资源趋势图；

* 私有镜像、云硬盘及编排数概览；

* 常用镜像列表（可点击镜像跳转到该镜像详情页面）；

* 历史操作记录： 同样可以点击右上角查看更多历史操作记录。

 
***
##3.2代码构建
点击左侧导航第二个入口可切换至代码构建，代码构建可以帮助开发者将已经写好的代码同步并打包成镜像至GaiaStack平台，这样就可以直接通过镜像部署应用让业务运行起来，达到全流程化的操作。同时在后续的代码更新中也可以通过自动构建的方式更新代码到GaiaStack平台生成新的版本。

###3.2.1如何创建一个构建项目？

1. 点击创建项目按钮；

2.  按照要求依次填写代码来源和构建项目基本信息。
![](/assets/4.png)
  其中常遇到的问题有以下几点：
 * 什么是代码分支？
       代码分支即为代码在仓库中保存的目录，在选择代码分支前需先点击同步代码方可选择。

 * 什么是Dockerfile路径？
Dockerfile是一个镜像的表示，可以通过Dockerfile来描述构建镜像的步骤；Dockerfile路径即为构建生成镜像的存储路径，默认为根目录可不填写，亦可根据个人习惯填写存储路径。

 * 开启自动构建会怎样？
开启自动构建后，当在代码仓库中push最新的代码后，将自动触发代码构建，在原有镜像下生成新的镜像版本；不会影响正在运行中的应用。
3. 点击快速创建完成项目构建。

###3.2.2构建列表

创建完成后页面将自动跳转后代码构建页面，展示相应的构建列表；其他情况下可以点击页面标题处的面包屑返回。


在构建列表中，你可以进行以下操作：

1. 点击构建项目当前行可选中构建项目进行删除操作，删除构建项目不影响已生成的镜像；

2. 点击构建项目名称，可进入构建详情；

3. 点击代码源可进入代码来源地址；

4. 点击镜像，则进入构建生成的镜像详情页面，正在构建中的镜像没有详情页面。

![](/assets/5.png)



**说明：**
构建项目列表默认部分业务，您可以看到您加入的所有业务的代码构建项目。GaiaStack目前版本构建项目的操作权限只限制到业务级别，也就是说同一个业务中的所有成员，对当前业务的构建项目均有操作权限

 

###3.2.3构建详情页面

点击构建项目的名称进入构建详情页面，详情页面展示构建项目的详情信息构建历史和日志，点击构建记录项可展开详细的日志信息。
![](/assets/206.png)

同时也可以对当前日志进行手动构建、删除和修改Dockerfile路径等操作。
***
##3.3镜像仓库
镜像仓库中展示了所有可用镜像内容。按照常用、我的镜像、业务镜像和全部，对镜像进行了分类，其中：

* 常用镜像：是指部署使用过的镜像

* 我的镜像：由代码构建生成，且放置于个人目录中的镜像，仅自己可见、可操作；截至V2.0.2版本暂不支持这项功能，我们会在后续版本中支持。

* 业务镜像：由代码构建生成，且属于业务的镜像，业务成员均可见、可操作；默认展示已加入的所有业务的镜像。

您可以通过分类tab快速删选镜像，也可以通过搜索进行检索
![](/assets/207.png)

找到镜像后，hover镜像Logo点击可进入镜像详情，点击下方部署按钮，可使用所选镜像快速部署生成应用。

点击进入镜像详情后可查看当前镜像的简介及版本更新历史，目前通过构建生成的镜像暂无简介，后续我们将支持用户编辑构建镜像的简介内容，敬请期待。

 ***
##3.4应用列表
应用列表是整个云实例平台的核心功能点，前面我们知道了如何把已经编写好的代码构建成为镜像，接下来就来看一下如何通过镜像生成应用，让业务跑起来。

###3.4.1如何创建一个应用？

1. 进入应用列表页面点击创建应用按钮；

2. 选择需要部署的镜像，即业务代码；
当然你也可以在镜像仓库中选中相应的镜像，点击部署。
![](/assets/209.png)
3. 填写部署信息，部署信息主要包含：部署对象、基本配置、配置管理、高级配置。

    3.1   部署配置: 即为所选镜像，可以点击更换；默认部署镜像的最新版本，您也可以切换为其他版本。
    ![](/assets/210.png)
    
    3.2 基本配置: 基本配置中除云硬盘外均为必填项，其中需注意：部署集群即为应用运行及资源消耗集群，集群资源不足会限制实例配置可选项及实例数量。
    ![](/assets/211.png)

      **说明:** 
      挂载云硬盘可以将应用运行结果数据保存，方便后续使用和数据共享；挂载云硬盘的应用只可包含一个实例，同一个应用可挂载多个云硬盘。应用与挂载的云硬盘需属于同一个集群下，不可跨集群挂载。
      
      勾选使用云硬盘后需选择要挂载的云硬盘，并填写挂载地址；因此需现在云硬盘页面中创建好可用的云硬盘。挂载地址是指云硬盘在应用上的位置路径，输入格式为路径格式。云硬盘挂载到应用上之后，只有应用结束方能对云硬盘进行操作或挂载至其他云硬盘。

     3.3 配置管理： 配置管理为非必填项，具有默认值可直接跳过不填。在应用部署时将配置导入到容器，支持环境变量和配置文件两种方式导入，同时支持无需停止服务状态下，对多个容器内配置文件进行在线更新。
     ![](/assets/22222222.png)
     
     3.4    高级配置: 高级配置为非必填项，具有默认值可直接跳过不填，如特殊需求可对高级配置进行修改。
     ![](/assets/212.png)
   
     
       * 启动命令。启动容器时将会运行的命令；指定启动命令后，镜像中指定的Entrypoint和Cmd将不再起作用。

       * 环境变量： 可根据所需增加或删减环境变量参数。如配置管理与高级配置环境变量冲突，则使用高级配置内用户手动填写的值。

       * 日志路径： 容器内用于存储日志的目录，该目录会被映射到主机的目录上，访问数据更快，且容器重启时，日志不受影响。

       * 数据路径： 容器内用于存储数据的目录，该目录会被映射到主机的目录上，访问数据更快，且容器重启时，数据不受影响。

       * 网络模式： 目前Gaia支持Overlay（虚拟网络）、Floating IP（浮动IP）、NAT（端口映射）、Host（宿主机网络）四种网络模式，可根据所需进行选择一种网络模式。

       * 自动扩缩容： 启动自动扩缩容，应用运行时可以根据各个实例的实际CPU使用率自动扩容、缩容。
    

 

###3.4.2应用管理

应用创建完成之后可点击返回应用列表页面，在应用列表页面你可以看到应用的基本信息及运行状态，点击左侧的加号，可展开查看应用下的实例运行信息。

勾选应用可对应用进行，启动、停止、弹性伸缩、灰度升级、删除等操作。其中仅删除支持批量操作。

* 启动： 停止的应用可点击再次启动。

* 停止： 各状态中的应用均可以点击进行停止，停止的应用服务将不可用，同时不再消耗资源。

* 弹性伸缩： 当需要扩大或缩小业务规模时可选择弹性伸缩；当前GaiaStack平台生成的应用为微服务类型的应用，应用各实例配置完全一致，弹性伸缩即增加或随机减少实例个数。
*灰度升级： 可以选择将当前应用镜像版本升级为其他版本，GaiaStack截至V2.0.2版本暂不支持自定义灰度升级时间间隔，默认不同实例间升级无时间间隔，我们将在后续版本中支持灰度策略。

*  删除： 删除当前应用，资源将自动回收，删除后的应用不显示在应用列表，请谨慎操作。

![](/assets/208.png)

 

**说明：**默认应用列表展示用户加入的所有业务的、通过所有途径创建的应用，包含后续将讲到的通过编排创建的应用。您可以通过表格右上角的搜索和筛选条件对应用进行快速查找。

###3.4.3应用详情

点击应用名称可进入应用详情页面，应用详情页面分为上下两部分。上部分主要展示应用的基本信息镜像版本、状态、归属等，以及应用操作；下部分则详细的展示了应用相关的配置信息、实例列表、资源监控、日志、操作记录。
![](/assets/21222.png)



* 应用详情中的操作与应用列表中的操作保持一直；

* 基本信息中的镜像版本和访问地址可分别点击前往详情页面；

* 概况： 主要内容为实例配置、挂载云硬盘信息以及高级配置信息，不支持修改；

* 实例： 展示了应用下的实例列表以及相关状态、镜像版本及IP信息，点击实例名称可进入实例详情页面；

* 监控： 目前包含了应用内存和CPU核使用趋势图[y2] ；

* 日志： 显示当前应用运行过程中的日志记录，至此按照关键词、主机、级别等查询；

* 操作记录： 即用户在前台针对当前应用的历史操作，及结果状态。

###3.4.4实例详情

通过点击应用列表中展开应用下的实例名，或者应用详情中实例列表的实例名，可进入实例详情页面。
![](/assets/2122222.png)


实例详情页面与应用详情页面结构类似，GaiaStack平台主持创建的应用均为微服务类型的应用，应用下各实例无实质差别，因此指定实例进行无可操作项。实例详情页面主要用于展示实例的详情信息，其中管理台为一个内嵌Webshell，您可以在这里直接对实例进行操作，语法操作与Linux一致。


***
##3.5配置管理
点击左侧导航应用管理->配置管理，可进入应用配置列表页面。
![](/assets/21222222.png)
应用配置组是一个应用的集合，可以是单个配置项，也可以是多个配置文件，帮助实现配置的统一管理，将image和配置内容解耦分离，在应用部署的时候可以将配置导入到容器中。应用配置列表默认展示用户配置的所有应用组，可根据右上角的搜索和筛选条件进行查询 。主要有以下操作：

 
*  创建配置组： 点击列表左上角创建配置组，在创建弹窗中填写相关信息；

* 配置组操作： 选中配置组，可进行添加配置项及删除操作，其中添加配置项需填写名称、业务、集群、内容四个必填项，填写完成进行创建 。创建完成后，可在列表查看配置项详情，查看配置项关联应用，并且可进行编辑、删除配置项操作。

 

 ***

##3.6云硬盘&云硬盘快照
 

云硬盘是可灵活挂在在应用实例上的存储空间，它可以帮助应用实现：数据持久化、不同的实例之间共享和重用数据、以及数据的备份、恢复和迁移。

###3.6.1云硬盘列表

点击左侧导航云硬盘->云硬盘列表，可进入云硬盘列表页面。云硬盘是作为应用的数据存储空间存在，在应用创建的时候挂载，应用结束后方能进行操作或挂载到其他应用上。云硬盘列表默认展示已加入业务的所有云硬盘，可根据右上角的搜索和筛选条件进行查询。
![](/assets/213.png)


* 创建云硬盘：点击列表左上角创建云硬盘，在创建弹窗中填写相关信息：
其中右侧可用资源为当前所选业务集群下的资源使用状况。云硬盘存储的数据文件系统目前支持：扩展文件系统EXT4和大文件XFS。
同时我们也可以从已有的云硬盘快照中创建云硬盘，那么新建的云硬盘中将包含原有快照中的数据内容，文件系统格式也将与原有快照保持一致。

* 云硬盘操作：只有未使用的云硬盘可进行操作，选中未使用中的云硬盘可进行扩容、删除、生成快照等操作。

* 云硬盘资源管理器：云硬盘资源管理器用于辅助管理云硬盘中的文件内容，你可以在界面中可视化的管理云硬盘中的文件。点击云硬盘列表右侧的按钮可以打开或关闭云硬盘管理器，使用中的云硬盘不可进行文件管理。

打开云硬盘管理器会消耗云硬盘所在集群微量资源，打开时一般需要20秒左右的加载时间。一般云硬盘资源管理器不会主动关闭，即资源不会主动回收，需手动关闭。打开资源管理器的云硬盘状态会显示为“管理中”。

###3.6.2云硬盘快照

云硬盘快照即对云硬盘创建快照生成的快照文件。勾选快照文件可进行删除，或通过快照文件创建云硬盘，这种方式创建的新云硬盘将包含快照文件内容，同时文件系统格式也与快照一致。

默认快照列表包含已加入的所有业务的云硬盘快照文件，可通过右上角的搜索和筛选条件进行查找。
***
##3.7应用编排
在实际业务中会遇到，业务代码是分多个镜像打包，而运维人员通常需要对业务的多个模块镜像进行一次性部署，这个时候就产生了应用编排的功能。您可以通过编写YAML文件的方式建立了一个编排模版，模版中可以包含多个应用、不同镜像版本、应用之间也可以建立依赖关系，然后再通过部署编排模版的方式让应用按照指定的顺序启动。
![](/assets/214.png)


###3.7.1如何创建一个编排模版？

1. 点击页面左上角的创建编排，为编排模版输入一个名称；
2. 选择所属业务，当前业务下的人员将都可见并且可以使用、编辑当前编排模版；
3. 编写文件内容。（如果您还不知道怎么编写YAML文件，那么你可以点击左下角的示例，我们为您准备了一个示例编排，您可以按照示例编排的格式编写自己的编排文件。）
![](/assets/215.png)

###3.7.2编排模版列表

编排模版列表展示了已加入业务的所有编排模版，可以通过右上角的搜索和筛选进行查找。其中：

* 点击编排模版名称可进入编排详情

* 点击部署可使用当前编排模版直接部署生成应用

* 下方显示内容问当前编排模版包含的应用对应的镜像，hover至镜像logo可查看镜像名称及版本。

###3.7.3编排详情

编排详情中显示了编排模版的详细内容，包含：编排基本信息、应用关系图、YAML文件及操作记录。
![](/assets/216.png)

其中YAML文件支持修改更新，修改后的YAML文件不影响已部署的应用，如需对已部署的应用进行更新可直接针对应用进行操作，或更新编排模版后重新部署。

###3.7.4如何通过编排模版创建一个应用？

1. 选定编排模版点击部署，跳转至应用创建页面：

2. 填写相关字段。由于应用的相关配置及所属业务已经在编排模版中设置过，因此只需填写部署名称，即当前部署的编排应用合集名称，部署集群即可一键部署。
3. 部署完成后可返回应用列表查看已部署应用的运行状态及详情。
![](/assets/217.png)

###3.7.5编排应用的展示和管理

编排应用同样展示在应用列表中，编排应用的名称=部署名称+YAML中应用名称。同样您也可以点击应用列表顶部的切换按钮切换至编排应用，然后按照部署集合的方式查看部署下的全部应用。

您可以通过勾选删除部署的方式对部署下的应用进行批量删除，编排应用的操作管理及详情与普通应用保持一直。

 


